<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="view_order_form_inherit_mollie" model="ir.ui.view">
            <field name="name">sale.order.form.inherit.mollie</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//sheet" position="before">
                    <div class="alert alert-info" attrs="{'invisible': [('is_mandate_approved', '=', True)]}">
                        <strong>Recurring Payments Setup Required</strong><br/>
                        To enable automatic recurring payments, you need to setup a payment mandate first.
                    </div>
                    <div class="alert alert-success" attrs="{'invisible': [('is_mandate_approved', '=', False)]}">
                        <strong>Recurring Payments Active</strong><br/>
                        Payment mandate is approved. Recurring payments will be processed automatically.
                    </div>
                </xpath>
                <xpath expr="//sheet" position="inside">
                    <group string="Mollie Recurring Payments">
                        <field name="is_mandate_approved" widget="boolean_button" 
                               options='{"icon": "fa-check", "string": "Mandate Status"}'/>
                        <field name="active_mandate_id" readonly="1"/>
                        <field name="is_recurring_order"/>
                        <field name="recurrence_interval" attrs="{'invisible': [('is_recurring_order', '=', False)]}"/>
                        <div class="button-box">
                            <button name="action_create_mollie_mandate" 
                                    type="object" 
                                    class="btn-primary"
                                    attrs="{'invisible': [('is_mandate_approved', '=', True)]}"
                                    string="Setup iDEAL Mandate"/>
                            <button name="action_create_recurring_payment" 
                                    type="object" 
                                    class="btn-secondary"
                                    attrs="{'invisible': [('is_mandate_approved', '=', False)]}"
                                    string="Create Test Recurring Payment"/>
                        </div>
                    </group>
                </xpath>
            </field>
        </record>

        <!-- Add a list view for recurring orders -->
        <record id="view_order_list_inherit_mollie" model="ir.ui.view">
            <field name="name">sale.order.list.inherit.mollie</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//list" position="inside">
                    <field name="is_mandate_approved" widget="boolean_button"/>
                    <field name="is_recurring_order" invisible="1"/>
                </xpath>
            </field>
        </record>
    </data>
</odoo>